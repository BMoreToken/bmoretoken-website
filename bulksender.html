<script src="web3.min.js"></script>

<script>
  
  
if (typeof window.ethereum !== 'undefined') {
  console.log('MetaMask is installed!');
}
window.onload=function(){
  
const ethereumButton = document.querySelector('.enableEthereumButton');
const showAccount = document.querySelector('.showAccount');
const tokenaddress = document.querySelector('.tokenaddress');  
const walletaddress = document.querySelector('.walletaddress');
const bulkaddress = document.querySelector('.bulkaddress');

const batchSendButton = document.querySelector('.batchSendButton');


 web3 = new Web3(web3.currentProvider);
  
  
ethereumButton.addEventListener('click', () => {
  getAccount();
});
  
batchSendButton.addEventListener('click', () => {
  bulkSendCoinWithSameValue();
});

async function bulkSendCoinWithSameValue() {
  const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
  const account = accounts[0];
  getERC20airdrop(account, (answer) => {
          document.getElementById('airdrop').innerText = answer.toString();
  });
    
    
    
    
    
    
}
  
  
   function getERC20airdrop(walletAddress, callback) {
      console.log('getERC20airdrop(' + walletAddress.toString() + ')');
      // ERC20
      let bulk_sending_ABI = [{"constant":true,"inputs":[],"name":"receiverAddress","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_tokenAddress","type":"address"},{"name":"_to","type":"address[]"},{"name":"_value","type":"uint256"}],"name":"drop","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":false,"inputs":[{"name":"_fee","type":"uint256"}],"name":"setVIPFee","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_tokenAddress","type":"address"},{"name":"_to","type":"address[]"},{"name":"_value","type":"uint256[]"}],"name":"bulksendToken","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":false,"inputs":[{"name":"_to","type":"address[]"},{"name":"_value","type":"uint256"}],"name":"bulkSendETHWithSameValue","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":true,"inputs":[],"name":"getReceiverAddress","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_to","type":"address[]"},{"name":"_value","type":"uint256[]"}],"name":"bulksend","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":false,"inputs":[{"name":"_tokenAddress","type":"address"},{"name":"_to","type":"address[]"},{"name":"_value","type":"uint256[]"}],"name":"bulkSendCoinWithDifferentValue","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":false,"inputs":[{"name":"_to","type":"address[]"},{"name":"_value","type":"uint256[]"}],"name":"bulkSendETHWithDifferentValue","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":false,"inputs":[{"name":"_addr","type":"address"}],"name":"setReceiverAddress","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"owner","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_tokenAddress","type":"address"},{"name":"_to","type":"address[]"},{"name":"_value","type":"uint256"}],"name":"bulkSendCoinWithSameValue","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":false,"inputs":[],"name":"registerVIP","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"vipList","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_vipList","type":"address[]"}],"name":"addToVIPList","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"txFee","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_fee","type":"uint256"}],"name":"setTxFee","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"VIPFee","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"_addr","type":"address"}],"name":"isVIP","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_vipList","type":"address[]"}],"name":"removeFromVIPList","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_tokenAddress","type":"address"}],"name":"getBalance","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_to","type":"address[]"},{"name":"_value","type":"uint256"}],"name":"sendEth","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"anonymous":false,"inputs":[{"indexed":false,"name":"token","type":"address"},{"indexed":false,"name":"total","type":"uint256"}],"name":"LogTokenBulkSent","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"token","type":"address"},{"indexed":false,"name":"receiver","type":"address"},{"indexed":false,"name":"balance","type":"uint256"}],"name":"LogGetToken","type":"event"}];

      
      let bulk_sending_contract = web3.eth.contract(bulk_sending_ABI).at('0x2667f647402423d4a68a926a10cc06d4593a0a84');
      
     /*
     
      function bulkSendCoinWithSameValue(address _tokenAddress, address[] _to, uint _value) payable public {
        coinSendSameValue(_tokenAddress, _to, _value);
    }
     
     
     */
//let send_to_array = ['0x2c7f5ab004c765A51f5958140cb9D47A74f35571','0x69BcD48E05A6Efe968Cef41fC778F574741924FF','0x3d0B130C2CA21cbc879029Daa2798A87B70Dc6F4','0xAD5faA074ee5287aA97c1DeA8D22443c57D20146','0x55bC26D9F91f304DE23b9bF3E7e3C6675980734E','0x17B76379DBD6D9b7A77B233cC744a743AE8bFd30'];
     
//let send_to_array = ['0x2c7f5ab004c765A51f5958140cb9D47A74f35571'];
     
     bulk_sending_contract.bulkSendCoinWithSameValue('0xbdd4f273c2b0f0b84a51bd733aac617d91159376','0x2c7f5ab004c765A51f5958140cb9D47A74f35571', parseInt(1), (error, answer) => {
        

          console.log('LIVE DROP: ' + answer.toString());
          callback(answer);

      });
      console.log('Drop Complete)');
    }
  
  
async function getAccount() {
  const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
  const account = accounts[0];
  //showAccount.innerHTML = account;
  walletaddress.innerHTML = account;
  tokenaddress.innerHTML = '0xbdd4f273c2b0f0b84a51bd733aac617d91159376';
  getERC20TokenBalance('0xbdd4f273c2b0f0b84a51bd733aac617d91159376', account, (balance) => {
          document.getElementById('result').innerText = balance.toString();
  }); 
   bulkaddress.innerHTML = '0x2667f647402423d4a68a926a10cc06d4593a0a84';
   getERC20isVIP(account, (answer) => {
          document.getElementById('isVIP').innerText = answer.toString();
  });
} 
  
  
}
  
  

 function getERC20TokenBalance(tokenAddress, walletAddress, callback) {

      // ERC20
      let minABI = [
        // balanceOf
        {
          "constant":true,
          "inputs":[{"name":"_owner","type":"address"}],
          "name":"balanceOf",
          "outputs":[{"name":"balance","type":"uint256"}],
          "type":"function"
        },
        // decimals
        {
          "constant":true,
          "inputs":[],
          "name":"decimals",
          "outputs":[{"name":"","type":"uint8"}],
          "type":"function"
        }
      ];

      
      let contract = web3.eth.contract(minABI).at(tokenAddress);
      
      contract.balanceOf(walletAddress, (error, balance) => {
        
        contract.decimals((error, decimals) => {
         
          balance = balance.div(10**decimals);
          console.log(balance.toString());
          callback(balance);
        });
      });
    }
  
   function getERC20isVIP(walletAddress, callback) {
      console.log('getERC20isVIP(' + walletAddress.toString() + ')');
      // ERC20
      let bulk_sending_ABI = [{"constant":true,"inputs":[],"name":"receiverAddress","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_tokenAddress","type":"address"},{"name":"_to","type":"address[]"},{"name":"_value","type":"uint256"}],"name":"drop","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":false,"inputs":[{"name":"_fee","type":"uint256"}],"name":"setVIPFee","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_tokenAddress","type":"address"},{"name":"_to","type":"address[]"},{"name":"_value","type":"uint256[]"}],"name":"bulksendToken","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":false,"inputs":[{"name":"_to","type":"address[]"},{"name":"_value","type":"uint256"}],"name":"bulkSendETHWithSameValue","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":true,"inputs":[],"name":"getReceiverAddress","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_to","type":"address[]"},{"name":"_value","type":"uint256[]"}],"name":"bulksend","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":false,"inputs":[{"name":"_tokenAddress","type":"address"},{"name":"_to","type":"address[]"},{"name":"_value","type":"uint256[]"}],"name":"bulkSendCoinWithDifferentValue","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":false,"inputs":[{"name":"_to","type":"address[]"},{"name":"_value","type":"uint256[]"}],"name":"bulkSendETHWithDifferentValue","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":false,"inputs":[{"name":"_addr","type":"address"}],"name":"setReceiverAddress","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"owner","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_tokenAddress","type":"address"},{"name":"_to","type":"address[]"},{"name":"_value","type":"uint256"}],"name":"bulkSendCoinWithSameValue","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":false,"inputs":[],"name":"registerVIP","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"vipList","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_vipList","type":"address[]"}],"name":"addToVIPList","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"txFee","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_fee","type":"uint256"}],"name":"setTxFee","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"VIPFee","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"_addr","type":"address"}],"name":"isVIP","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_vipList","type":"address[]"}],"name":"removeFromVIPList","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_tokenAddress","type":"address"}],"name":"getBalance","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_to","type":"address[]"},{"name":"_value","type":"uint256"}],"name":"sendEth","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"anonymous":false,"inputs":[{"indexed":false,"name":"token","type":"address"},{"indexed":false,"name":"total","type":"uint256"}],"name":"LogTokenBulkSent","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"token","type":"address"},{"indexed":false,"name":"receiver","type":"address"},{"indexed":false,"name":"balance","type":"uint256"}],"name":"LogGetToken","type":"event"}];

      
      let bulk_sending_contract = web3.eth.contract(bulk_sending_ABI).at('0x2667f647402423d4a68a926a10cc06d4593a0a84');
      
      bulk_sending_contract.isVIP(walletAddress, (error, answer) => {
        

          console.log(answer.toString());
          callback(answer);

      });
    }
  
  
</script>
<style>
 @media (min-width:1025px) { .container { width: 50% !important;} }
</style>
<center>
<div class="container">
  <center>    
    <div class="row" style='text-align:left;'>
     
     <button class="enableEthereumButton">Connect MetaMask</button>

      <h1>BMoreToken:</h1>

      <h3>Token: <span class="tokenaddress" id="tokenaddress"></h3>
 
      <h3>Wallet: <span class="walletaddress" id="walletaddress"></span></h3>
 
      <h2>Balance: <span id="result"></span></h2>
 
      <h1>BulkSender:</h1>
      <h3>Contract: <span class="bulkaddress" id="bulkaddress"></span></h3>
      <h3>isVIP: <span id="isVIP"></span></h3>
      <h3>Status: <span id="airdrop"></span></h3>  
      <h1>Send Same amount to All Addresses </h1>  
        <small>bulkSendCoinWithSameValue()</small><br>
      <table>
        <tr>
          <td>Addresses (CSV)</td>
          <td><textarea></textarea></td>
        </tr>  
        <tr>
          <td>Amount to Send (to each)</td>
          <td><input></td>
        </tr>  
        <tr>
          <td></td>
          <td><button class="batchSendButton">Batch Send</button></td>
        </tr>  
      </table>   
<hr>

  <h3>*** DEBUGGING ***</h3>
  <pre>
using SafeMath for uint;

event LogTokenBulkSent(address token, uint256 total);
event LogGetToken(address token, address receiver, uint256 balance);
address public receiverAddress;
uint public txFee = 0.01 ether;
uint public VIPFee = 1 ether;

/* VIP List */
mapping(address => bool) public vipList;

/*
*  get balance
*/
function getBalance(address _tokenAddress) onlyOwner public {
    address _receiverAddress = getReceiverAddress();
    if (_tokenAddress == address(0)) {
        require(_receiverAddress.send(address(this).balance));
        return;
    }
    StandardToken token = StandardToken(_tokenAddress);
    uint256 balance = token.balanceOf(this);
    token.transfer(_receiverAddress, balance);
    emit LogGetToken(_tokenAddress, _receiverAddress, balance);
}

/*
*  Register VIP
*/
function registerVIP() payable public {
    require(msg.value >= VIPFee);
    address _receiverAddress = getReceiverAddress();
    require(_receiverAddress.send(msg.value));
    vipList[msg.sender] = true;
}

/*
*  VIP list
*/
function addToVIPList(address[] _vipList) onlyOwner public {
    for (uint i = 0; i < _vipList.length; i++) {
        vipList[_vipList[i]] = true;
    }
}

/*
* Remove address from VIP List by Owner
*/
function removeFromVIPList(address[] _vipList) onlyOwner public {
    for (uint i = 0; i < _vipList.length; i++) {
        vipList[_vipList[i]] = false;
    }
}

/*
    * Check isVIP
*/
function isVIP(address _addr) public view returns(bool) {
    return _addr == owner || vipList[_addr];
}

/*
    * set receiver address
*/
function setReceiverAddress(address _addr) onlyOwner public {
    require(_addr != address(0));
    receiverAddress = _addr;
}

/*
    * get receiver address
*/
function getReceiverAddress() public view returns(address) {
    if (receiverAddress == address(0)) {
        return owner;
    }

    return receiverAddress;
}

/*
    * set vip fee
*/
function setVIPFee(uint _fee) onlyOwner public {
    VIPFee = _fee;
}

/*
    * set tx fee
*/
function setTxFee(uint _fee) onlyOwner public {
    txFee = _fee;
}

function ethSendSameValue(address[] _to, uint _value) internal {

    uint sendAmount = _to.length.sub(1).mul(_value);
    uint remainingValue = msg.value;

    bool vip = isVIP(msg.sender);
    if (vip) {
        require(remainingValue >= sendAmount);
    } else {
        require(remainingValue >= sendAmount.add(txFee));
    }
    require(_to.length <= 255);

    for (uint8 i = 1; i < _to.length; i++) {
        remainingValue = remainingValue.sub(_value);
        require(_to[i].send(_value));
    }

    emit LogTokenBulkSent(0x000000000000000000000000000000000000bEEF, msg.value);
}

function ethSendDifferentValue(address[] _to, uint[] _value) internal {

    uint sendAmount = _value[0];
    uint remainingValue = msg.value;

    bool vip = isVIP(msg.sender);
    if (vip) {
        require(remainingValue >= sendAmount);
    } else {
        require(remainingValue >= sendAmount.add(txFee));
    }

    require(_to.length == _value.length);
    require(_to.length <= 255);

    for (uint8 i = 1; i < _to.length; i++) {
        remainingValue = remainingValue.sub(_value[i]);
        require(_to[i].send(_value[i]));
    }
    emit LogTokenBulkSent(0x000000000000000000000000000000000000bEEF, msg.value);

}

function coinSendSameValue(address _tokenAddress, address[] _to, uint _value) internal {

    uint sendValue = msg.value;
    bool vip = isVIP(msg.sender);
    if (!vip) {
        require(sendValue >= txFee);
    }
    require(_to.length <= 255);

    address from = msg.sender;
    uint256 sendAmount = _to.length.sub(1).mul(_value);

    StandardToken token = StandardToken(_tokenAddress);
    for (uint8 i = 1; i < _to.length; i++) {
        token.transferFrom(from, _to[i], _value);
    }

    emit LogTokenBulkSent(_tokenAddress, sendAmount);

}

function coinSendDifferentValue(address _tokenAddress, address[] _to, uint[] _value) internal {
    uint sendValue = msg.value;
    bool vip = isVIP(msg.sender);
    if (!vip) {
        require(sendValue >= txFee);
    }

    require(_to.length == _value.length);
    require(_to.length <= 255);

    uint256 sendAmount = _value[0];
    StandardToken token = StandardToken(_tokenAddress);

    for (uint8 i = 1; i < _to.length; i++) {
        token.transferFrom(msg.sender, _to[i], _value[i]);
    }
    emit LogTokenBulkSent(_tokenAddress, sendAmount);

}

/*
    Send ether with the same value by a explicit call method
*/

function sendEth(address[] _to, uint _value) payable public {
    ethSendSameValue(_to, _value);
}

/*
    Send ether with the different value by a explicit call method
*/
function bulksend(address[] _to, uint[] _value) payable public {
    ethSendDifferentValue(_to, _value);
}

/*
    Send ether with the different value by a implicit call method
*/

function bulkSendETHWithDifferentValue(address[] _to, uint[] _value) payable public {
    ethSendDifferentValue(_to, _value);
}

/*
    Send ether with the same value by a implicit call method
*/

function bulkSendETHWithSameValue(address[] _to, uint _value) payable public {
    ethSendSameValue(_to, _value);
}

/*
    Send coin with the same value by a implicit call method
*/

function bulkSendCoinWithSameValue(address _tokenAddress, address[] _to, uint _value) payable public {
    coinSendSameValue(_tokenAddress, _to, _value);
}

/*
    Send coin with the different value by a implicit call method, this method can save some fee.
*/
function bulkSendCoinWithDifferentValue(address _tokenAddress, address[] _to, uint[] _value) payable public {
    coinSendDifferentValue(_tokenAddress, _to, _value);
}

/*
    Send coin with the different value by a explicit call method
*/
function bulksendToken(address _tokenAddress, address[] _to, uint[] _value) payable public {
    coinSendDifferentValue(_tokenAddress, _to, _value);
}
/*
    Send coin with the same value by a explicit call method
*/
function drop(address _tokenAddress, address[] _to, uint _value) payable public {
    coinSendSameValue(_tokenAddress, _to, _value);
}
 </pre> 
      
    </div>
  </center>      
</div>






